(function(){var c,a,b;b=(function(){var e,f,d;g.STONE_IMAGE_WIDTH=50;g.STONE_IMAGE_HEIGHT=50;g.VOID="images/void.jpg";g.BLACK="images/black.jpg";g.WHITE="images/white.jpg";g.HINT_B="images/hintB.jpg";g.HINT_W="images/hintW.jpg";e=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];function g(i,j,h){this.gameSize=j!=null?j:8;this.stoneDispWidth=h!=null?h:1;this.fps=i.fps;this.num_stone=this.gameSize*this.gameSize;this.scale=this.stoneDispWidth/g.STONE_IMAGE_WIDTH;this.SPRITES=[];this.BoardState=[];this.turn=1;this.start=false;this.BlackStone=this.WhiteStone=0;this.players=[0,0];this.records=[];this.play_pos=0;this.replay_mode=false;i.preload([g.VOID,g.BLACK,g.WHITE,g.HINT_B,g.HINT_W])}g.prototype.setCPUs=function(h){this.cpus=h};g.prototype.isInBoard=function(h,i){return(h>=0)&&(h<this.gameSize)&&(i>=0)&&(i<this.gameSize)};g.prototype.xy2pos=function(h,i){return h+i*this.gameSize};g.prototype.pos2xy=function(h){return[h%this.gameSize,Math.floor(h/this.gameSize)]};g.prototype._getSprite=function(m){var p,i,h,o,n,l,k,j;l=[g.STONE_IMAGE_WIDTH,g.STONE_IMAGE_HEIGHT],h=l[0],p=l[1];i=new Sprite(h,p);i.image=new Surface(h*5,p);i.pos=m;k=this.pos2xy(m),o=k[0],n=k[1];i.frame=0;i.scale(this.scale,this.scale);j=[o*h*this.scale,n*p*this.scale],i.x=j[0],i.y=j[1];i.image.draw(enchant.Game.instance.assets[g.VOID],0,0,h,p,0,0,h,p);i.image.draw(enchant.Game.instance.assets[g.BLACK],0,0,h,p,h,0,h,p);i.image.draw(enchant.Game.instance.assets[g.WHITE],0,0,h,p,h*2,0,h,p);i.image.draw(enchant.Game.instance.assets[g.HINT_B],0,0,h,p,h*3,0,h,p);i.image.draw(enchant.Game.instance.assets[g.HINT_W],0,0,h,p,h*4,0,h,p);return i};g.prototype.createBoard=function(){var j,i,h;this.SPRITES=[];for(j=i=0,h=this.num_stone;0<=h?i<h:i>h;j=0<=h?++i:--i){this.SPRITES.push(this._getSprite(j))}this.firstScene();return this.SPRITES};g.prototype.firstScene=function(){var l,h,k,j;for(h=k=0,j=this.num_stone;0<=j?k<j:k>j;h=0<=j?++k:--k){this.SPRITES[h].frame=0;this.BoardState[h]=0}l=this.gameSize*(Math.floor(this.gameSize/2-1))+Math.floor(this.gameSize/2-1);this.SPRITES[l].frame=this.SPRITES[l+this.gameSize+1].frame=2;this.BoardState[l]=this.BoardState[l+this.gameSize+1]=-1;this.SPRITES[l+1].frame=this.SPRITES[l+this.gameSize].frame=1;this.BoardState[l+1]=this.BoardState[l+this.gameSize]=1;this.BlackStone=this.WhiteStone=2;return document.myForm.black.value=document.myForm.white.value=2};g.prototype.checkInvert=function(){var B,v,A,z,u,t,w,p,s,q,l,j,r,o,n,m,k,h;v=[];for(p=l=0,r=this.num_stone;0<=r?l<r:l>r;p=0<=r?++l:--l){if(this.BoardState[p]===0){o=this.pos2xy(p),s=o[0],q=o[1];for(w=j=0,n=e.length;0<=n?j<n:j>n;w=0<=n?++j:--j){m=[e[w][0],e[w][1]],u=m[0],t=m[1];k=[1,u,t],B=k[0],A=k[1],z=k[2];while(this.isInBoard(s+A,q+z)&&(this.BoardState[this.xy2pos(s+A,q+z)]===(-1*this.turn))){h=[B+1,A+u,z+t],B=h[0],A=h[1],z=h[2]}if((this.BoardState[this.xy2pos(s+A,q+z)]===this.turn)&&(B>1)){this.BoardState[p]=2;this.SPRITES[p].frame=(this.turn>0?3:4);v.push(p);break}}}}return v};g.prototype.setStone=function(h,i){var j;if(i==null){i={delay:0,turn:this.turn}}j=i.turn===1?1:2;if((this.players[0]>0&&this.players[1]>0)||(this.replay_mode===true)){return h.frame=j}else{return h.tl.delay(i.delay*this.fps).then(function(){return this.frame=j})}};g.prototype.turnStone=function(h,i){var j;if(i==null){i={delay:0.4,turn:this.turn}}j=i.turn===1?1:2;if((this.players[0]>0&&this.players[1]>0)||(this.replay_mode===true)){return h.frame=j}else{return h.tl.delay(i.delay*this.fps).scaleTo(0.1*this.scale,this.scale,0.2*this.fps).then(function(){return this.frame=j}).scaleTo(this.scale,this.scale,this.fps*0.2)}};g.prototype.putStone=function(s,B){var F,A,G,r,E,D,z,w,C,v,t,o,m,u,q,p,n,l,k,j,h;if(B==null){B={delay:0,turn:this.turn}}if(!this.start){return f("[スタート！]を押してください！")}else{if(this.BoardState[s]!==2&&this.replay_mode===false){return f("置けません！")}else{for(C=o=0,u=this.num_stone;0<=u?o<u:o>u;C=0<=u?++o:--o){if(this.BoardState[C]===2){this.BoardState[C]=0;this.SPRITES[C].frame=0}}q=this.pos2xy(s),v=q[0],t=q[1];f("("+(v+1)+", "+(t+1)+") に置きました！");this.recordPlay([this.turn,v+1,t+1]);for(C=m=0,p=e.length;0<=p?m<p:m>p;C=0<=p?++m:--m){n=[e[C][0],e[C][1]],z=n[0],w=n[1];l=[1,z,w],F=l[0],E=l[1],D=l[2];while(this.isInBoard(v+E,t+D)&&(this.BoardState[this.xy2pos(v+E,t+D)]===(this.turn*-1))){k=[F+1,E+z,D+w],F=k[0],E=k[1],D=k[2]}if(this.BoardState[this.xy2pos(v+E,t+D)]===this.turn){j=[F-1,E-z,D-w],F=j[0],E=j[1],D=j[2];while(F>0){this.BoardState[this.xy2pos(v+E,t+D)]=this.turn;if(this.turn>0){this.BlackStone++;this.WhiteStone--}else{this.WhiteStone++;this.BlackStone--}this.turnStone(this.SPRITES[this.xy2pos(v+E,t+D)],{delay:B.delay+0.3,turn:this.turn});h=[F-1,E-z,D-w],F=h[0],E=h[1],D=h[2]}}}this.BoardState[s]=this.turn;if(!this.SPRITES[s]){alert(s)}this.setStone(this.SPRITES[s],{delay:B.delay,turn:this.turn});if(this.turn>0){this.BlackStone++}else{this.WhiteStone++}document.myForm.black.value=this.BlackStone;document.myForm.white.value=this.WhiteStone;this.turn*=-1;A=this.checkInvert();if(A.length===0){f(this.turn>0?"先手はパスです！":"後手はパスです！");this.recordPlay([this.turn,0,0]);this.turn*=-1;A=this.checkInvert();if(A.length===0){f("終了");d("はじめから");return}}if(((this.turn===1&&this.players[0]>0)||(this.turn===-1&&this.players[1]>0))&&(this.replay_mode===false)){G=this.turn===1?this.players[0]-1:this.players[1]-1;r=this.cpus[G].play(this.BoardState.slice(0),A.slice(0));if(r!==null){return this.putStone(r,{delay:B.delay+0.8,turn:this.turn})}}}}};g.prototype.recordPlay=function(h){if(!this.replay_mode){if(this.play_pos!==this.records.length){this.records=this.records.slice(0,this.play_pos)}this.records.push(h);return this.play_pos=this.records.length}};g.prototype.exitReplay=function(){return this.replay_mode=false};g.prototype.replay=function(m,h){var j,l,k;this.replay_mode=true;this.firstScene();this.turn=1;if(h<0){h=0}if(h>m.length){h=m.length}if(h>0){for(j=k=0;0<=h?k<h:k>h;j=0<=h?++k:--k){l=(m[j][1]-1)+(m[j][2]-1)*this.gameSize;if(l>=0){this.turn=m[j][0];this.putStone(l)}}}if(h<=0){f("初期画面を表示しています。")}this.play_pos=h;return this.replay_mode=false};g.prototype.historyTop=function(){return this.replay(this.records,0)};g.prototype.historyLast=function(){return this.replay(this.records,this.records.length)};g.prototype.history=function(h){return this.replay(this.records,this.play_pos+h)};g.prototype.savePlay=function(){return alert(JSON.stringify({black:this.BlackStone,white:this.WhiteStone,play:this.records}))};g.prototype.loadPlay=function(){return console.log("未実装")};g.prototype.setPlayers=function(){return this.players=[document.myForm.first.selectedIndex,document.myForm.second.selectedIndex]};g.prototype.gameStart=function(){var h;if(!this.start){this.setPlayers();this.start=true;this.records=[];this.play_pos=0;f("ゲームスタート！！");d("やりなおす");h=this.checkInvert();if(this.players[0]>0&&h.length>0){return this.putStone(this.cpus[this.players[0]-1].play(this.BoardState.slice(0),h.slice(0)))}}else{if(confirm("本当にやり直しますか？")){this.firstScene();this.turn=1;this.start=false;d("スタート！");return f("やりなおしました")}}};f=function(h){return document.myForm.myMsg.value=h};d=function(h){return document.myForm.start.value=h};return g})();enchant();c=(function(){function d(){}d.prototype.play=function(f,e){if(e.length===0){return null}else{return e[0]}};return d})();a=(function(){function d(){}d.prototype.play=function(f,e){if(e.length===0){return null}else{return e[Math.floor(Math.random()*e.length)]}};return d})();window.onload=function(){var d,f,e,g;e=8;f=320;d=new Core(f+10,f+10);g=new b(d,e,Math.floor(f/e));this.reversi=g;g.setCPUs([new c(),new a()].slice(0));d.onload=function(){var k,j,l,i,h;k=g.createBoard();h=[];for(l=0,i=k.length;l<i;l++){j=k[l];d.rootScene.addChild(j);h.push(j.addEventListener("touchend",function(){g.exitReplay();g.setPlayers();return g.putStone(this.pos)}))}return h};return d.start()}}).call(this);